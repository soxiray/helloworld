# 场外期权-管理端-权限控制-后端开发设计



## 数据库设计

用户表（OTC_OPTION_INNER_WHITE_LIST）：

| 字段                     | 说明                           | 默认值                       |
| ------------------------ | ------------------------------ | ---------------------------- |
| id(bigint)               | ID                             | 1000开始，新增数据取 max + 1 |
| account(varchar128)      | 账号                           |                              |
| email(varchar256)        | 邮箱                           |                              |
| name(varchar256)         | 姓名                           |                              |
| phone(varchar64)         | 手机号                         |                              |
| dept(varchar256)         | 部门                           |                              |
| temp_password(varchar16) | 密码（仅限登录DEV/UAT环境)     |                              |
| deleted(tinyint)         | 删除标识（0-未删除，1-已删除） | 0                            |
| enable(tinyint)          | 启用标识（0-禁用，1-启用）     | 0                            |
| create_time(datetime)    | 创建时间                       | getdate()                    |
| update_time(datetime)    | 修改时间                       | getdate()                    |

角色表（OTC_OPTION_INNER_ROLE)

| 字段                  | 说明                           | 默认值                       |
| --------------------- | ------------------------------ | ---------------------------- |
| id(bingint)           | ID                             | 1000开始，新增数据取 max + 1 |
| role_name(varchar128) | 角色名称                       |                              |
| role_desc(varchar256) | 角色说明                       |                              |
| deleted(tinyint)      | 删除标识（0-未删除，1-已删除） | 0                            |
| enable(tinyint)       | 启用标识（0-禁用，1-启用）     | 1                            |
| create_time(datetime) | 创建时间                       | getdate()                    |
| update_time(datetime) | 修改时间                       | getdate()                    |

用户角色关联表（OTC_OPTION_INNER_USER_ROLE）

| 字段            | 说明   | 默认值 |
| --------------- | ------ | ------ |
| user_id(bigint) | 用户ID |        |
| role_id(bigint) | 角色ID |        |

菜单表（OTC_OPTION_INNER_MENU）

| 字段                  | 说明                               | 默认值                       |
| --------------------- | ---------------------------------- | ---------------------------- |
| id(bingint)           | ID                                 | 1000开始，新增数据取 max + 1 |
| parent_id(bigint)     | 父菜单ID                           |                              |
| title(varchar128)     | 菜单名称                           |                              |
| type(tinyint)         | 菜单类型（0-目录，1-菜单，2-按钮） |                              |
| path(varchar256)      | 菜单URL                            |                              |
| icon(varchar256)      | 菜单图标                           |                              |
| seq(bigint)           | 排序值                             |                              |
| btn_code(varchar64)   | 按钮编码                           |                              |
| deleted(tinyint)      | 删除标识（0-未删除，1-已删除）     | 0                            |
| enable(tinyint)       | 启用标识（0-禁用，1-启用）         | 1                            |
| create_time(datetime) | 创建时间                           | getdate()                    |
| update_time(datetime) | 修改时间                           | getdate()                    |

角色菜单关联表（OTC_OPTION_INNER_ROLE_MENU）

| 字段            | 说明   | 默认值 |
| --------------- | ------ | ------ |
| role_id(bigint) | 角色ID |        |
| menu_id(bigint) | 菜单ID |        |

## 功能设计

#### 1.用户管理(OtcWhiteListController)

- 添加用户功能

  可录入的字段为：用户账号、姓名、手机号、邮箱、部门、所属角色

  账号为用户AD域账号

  部门下拉列表数据来源于字典表：OTC_OPTION_DICTIONARY 

  创建的用户默认启用

  创建的用户密码默认为手机号，如果手机号为空，密码默认为123456 (此密码仅用于登录DEV/UAT环境)

  如果配置项 ADAccount.check=true，则检查用户账户是否在内部用户表：OTC_OPTION_INNER_USER_INFO

  如果创建的用户之前被删除、则修改删除标识为0

  不能添加已存在、但未删除的用户账号

- 列表查询

  支持分页

  支持以账号、手机号、部门、角色 作为查询条件来查询数据

  列表显示字段：账号、姓名、手机号、邮箱、部门、用户角色中文、启用状态

  列表支持的操作：编辑、删除、启用禁用用户

  显示已禁用的用户

  不显示已删除的用户

- 编辑用户

  不可修改用户账号

  可修改用户 姓名、手机号、邮箱、部门、所属角色

- 删除功能

  使用逻辑删除，修改表删除标识字段：deleted=1

  同时删除用户所有角色关联关系

- 禁用/启用用户

  修改表启用标识字段：enable

#### 2.角色管理(OtcRoleController)

- 添加角色

  可录入的字段为：角色名称、角色说明、角色拥有的菜单权限

  不能添加已存在、但未删除的角色名称

- 列表查询

  支持分页

  不需要查询条件

  列表显示的字段：角色ID、角色名称、启用状态、创建时间、更新时间

  列表支持的操作：查询角色下用户列表、编辑、删除、启用禁用

- 修改角色

  可修改角色名称、角色说明、角色拥有的菜单权限

  角色名称不可修改为已存在、但未删除的角色名称

- 查询角色用户

  弹窗显示该角色下的用户列表

  显示字段为：角色名称、用户账户、姓名、部门

  显示已禁用的用户

  不显示已删除的用户

- 删除角色

  使用逻辑删除，修改表删除标识字段：deleted=1

  同时删除角色所有菜单关联关系

- 启用禁用角色

  修改表启用标识字段：enable

#### 3.菜单管理(OtcMenuController)

- 添加菜单

  可录入的字段为：菜单名称、菜单图标、菜单按钮、菜单URL、菜单类型、所属菜单、排序值

  菜单类型：目录 > 菜单 > 按钮

  ​		目录为最高级菜单，没有所属菜单

  ​		菜单的父级为目录、按钮的父级为菜单

  ​		目录需录入图标

  ​		目录、菜单 需录入排序值

  ​		按钮需录入按钮编码，按钮编码不能重复

  菜单URL：

  ​		目录和菜单的URL为前端路由路径 且不能重复

  ​		按钮的URL为该按钮对应功能的后端接口路径  不同按钮的URL可以重复

  ​		按钮的URL用户后端控制接口权限

​		排序值：同一级别的菜单排序值从小到大填写，功能的排序值为空

​		所属菜单不能是已禁用的菜单

- 列表查询

  支持分页

  支持按菜单名称、启用状态、所属菜单、菜单类型检索

  列表显示的字段：菜单ID、菜单名称、图标、菜单URL、类型、所属菜单、排序、启用状态、创建时间

  列表支持的操作：编辑、删除、启用禁用

- 编辑菜单

  与创建菜单逻辑一致

- 删除菜单

  使用逻辑删除，修改表删除标识字段：deleted=1

  删除菜单会遍历删除其子菜单或子按钮

  同时删除菜单所有角色关联关系

- 启用禁用菜单

  修改表启用标识字段：enable

  禁用菜单会遍历禁用其子菜单或子按钮

  启用菜单会遍历启用其父菜单或父目录

#### 4.登录接口逻辑修改

​	登录时需同时返回用户有权限的菜单列表、按钮编码列表